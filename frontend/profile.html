<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Profile - Sugar Dating</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<div class="container">
  <h2>Update Profile</h2>
  <input type="text" id="name" placeholder="Name">
  <input type="password" id="password" placeholder="New Password">
  <input type="date" id="dob">
  <select id="role">
    <option value="sugar_mummy">Sugar Mummy</option>
    <option value="young_adult">Young Adult</option>
  </select>
  <button id="updateBtn">Update</button>
  <p id="message"></p>
  <button onclick="logout()">Logout</button>
</div>

<script>
const token = localStorage.getItem("token");
const user = JSON.parse(localStorage.getItem("user"));

if (!token) window.location.href = "login.html";

// Pre-fill current info
document.getElementById("name").value = user.name;
document.getElementById("dob").value = user.dateOfBirth;
document.getElementById("role").value = user.role;

document.getElementById("updateBtn").addEventListener("click", async () => {
  const name = document.getElementById("name").value;
  const password = document.getElementById("password").value;
  const dob = document.getElementById("dob").value;
  const role = document.getElementById("role").value;

  try {
    const res = await fetch(`https://sugar-dating-site.onrender.com/api/users/${user.email}`, {
      method: "PUT",
      headers: { 
        "Content-Type": "application/json",
        "Authorization": `Bearer ${token}`
      },
      body: JSON.stringify({ name, password, dateOfBirth: dob, role })
    });

    const data = await res.json();
    document.getElementById("message").innerText = data.message || data.error;

  } catch {
    document.getElementById("message").innerText = "Network error. Try again.";
  }
});

function logout() {
  localStorage.removeItem("token");
  localStorage.removeItem("user");
  window.location.href = "login.html";
}
</script>
</body>
</html>
